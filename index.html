<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WORLD OUT FASHION</title>
    
    <!-- --- FAVICON SETUP (මෙන්න අයිකන් එක සඳහා කෝඩ් එක) --- -->
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="shortcut icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png"> <!-- For iPhone/iPad Home Screen -->
    <!-- ----------------------------------------------------- -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary-color: #007BFF; /* Blue */
            --primary-dark: #0056B3;
            --secondary-color: #000000; /* Black */
            --background-color: #FFFFFF; 
            --card-background: #F8F9FA; 
            --border-color: #DEE2E6;
            --watermark-idle: #b3b3b3; 
            --watermark-hover: #333333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body { 
            background: var(--background-color); 
            height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            overflow: hidden;
            perspective: 2000px; /* Enhanced 3D Depth */
        }

        /* --- LOGIN & BACKGROUND --- */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #login-screen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; 
            flex-direction: column; justify-content: center; align-items: center; z-index: 10;
            background: linear-gradient(-45deg, #ffffff, #e6f2ff, #cce5ff, #ffffff);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite;
            transition: filter 0.5s ease; /* Smooth blur transition */
        }

        @keyframes slideInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes floatLogo { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }

        .logo-container { margin-bottom: 40px; opacity: 0; animation: slideInUp 0.8s forwards; animation-delay: 0.1s; }
        .logo { width: 180px; height: 180px; border-radius: 50%; display: flex; justify-content: center; align-items: center; overflow: hidden; background: white; animation: floatLogo 4s ease-in-out infinite; }
        .logo img { width: 100%; height: 100%; object-fit: cover; }
        
        .login-form { 
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); padding: 40px; 
            border-radius: 20px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1); width: 90%; 
            max-width: 400px; text-align: center; border: 1px solid rgba(0, 0, 0, 0.1);
            opacity: 0; animation: slideInUp 0.8s forwards; animation-delay: 0.3s;
        }

        .login-form h2 { color: var(--secondary-color); }
        .input-group input { width: 100%; padding: 15px; border: 1px solid var(--border-color); border-radius: 50px; text-align: center; margin-bottom: 15px; outline: none; }
        .login-btn { width: 100%; padding: 15px; border: none; border-radius: 50px; background: linear-gradient(45deg, var(--primary-color), var(--primary-dark)); color: white; font-weight: 600; cursor: pointer; transition: 0.3s; }

        /* --- DASHBOARD --- */
        #dashboard { width: 100%; height: 100%; display: none; flex-direction: column; padding: 20px; z-index: 5; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px; margin-bottom: 40px; }
        .header h1 { color: var(--secondary-color); font-weight: 800; }
        
        .dashboard-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; 
            width: 100%; max-width: 1200px; margin: 0 auto; padding-bottom: 120px;
            perspective: 1000px; 
        }
        
        /* ITEM STYLES with POP-UP EFFECT */
        .dashboard-item { 
            background: var(--card-background); border-radius: 20px; padding: 30px; text-align: center; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy transition */
            cursor: pointer; text-decoration: none; 
            border: 1px solid var(--border-color); 
            opacity: 1; 
        }

        /* Requirement 1: Pop-up & Shadow on Hover */
        .dashboard-item:hover { 
            transform: translateY(-15px) scale(1.05); /* Pop Up */
            border-color: var(--primary-color);
            box-shadow: 0 30px 60px rgba(0, 123, 255, 0.25); /* Strong Drop Shadow */
        }
        
        .icon { font-size: 60px; margin-bottom: 20px; color: var(--primary-color); transition: transform 0.3s; }
        .dashboard-item:hover .icon { transform: scale(1.1) rotate(5deg); } /* Icon shakes a bit */
        
        .dashboard-item h2 { color: var(--secondary-color); margin-bottom: 10px; font-weight: 700; }
        .dashboard-item p { color: #555; }

        /* --- ENERGY BLUR LOADING ANIMATION --- */
        #energy-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999;
            display: none; justify-content: center; align-items: center;
            /* Requirement 2: Blur instead of Black */
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px); 
            overflow: hidden;
        }

        .energy-core {
            width: 10px; height: 10px;
            background: var(--primary-color);
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 30px var(--primary-color);
            animation: pulseCore 0.5s infinite alternate;
        }

        .particle {
            position: absolute;
            width: 100px; height: 3px;
            /* Blue and Black particles for visibility on blur */
            background: linear-gradient(90deg, transparent, var(--primary-dark), var(--secondary-color)); 
            transform-origin: right center;
            opacity: 0;
        }

        /* Sucking in animation */
        @keyframes implode {
            0% { transform: rotate(var(--angle)) translateX(600px) scaleX(1); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: rotate(var(--angle)) translateX(0px) scaleX(0.1); opacity: 0; }
        }
        
        @keyframes pulseCore { from { transform: scale(1); } to { transform: scale(2); } }

        @keyframes explodeCore {
            0% { transform: scale(1); opacity: 1; }
            40% { transform: scale(50); opacity: 1; background: white; }
            100% { transform: scale(150); opacity: 0; }
        }

        /* Flash */
        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 10000; pointer-events: none;
            opacity: 0; transition: opacity 0.6s ease-out;
        }

        /* --- SCATTER & ASSEMBLE ANIMATION --- */
        /* Requirement 3: Icons scatter then assemble */
        .assemble-3d {
            animation: assembleFromChaos 1.2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes assembleFromChaos {
            0% { 
                opacity: 0;
                /* Starts from random positions set by JS variable */
                transform: translate3d(var(--startX), var(--startY), var(--startZ)) rotate(180deg) scale(0.5);
            }
            70% {
                opacity: 1;
                transform: translate3d(0, 0, 0) rotate(-10deg) scale(1.05); /* Slight overshoot */
            }
            100% { 
                opacity: 1;
                transform: translate3d(0, 0, 0) rotate(0deg) scale(1); /* Land perfectly */
            }
        }

        /* --- FOOTER & UTILS --- */
        .branding-link {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 12px; align-items: center; text-decoration: none; z-index: 1000;
            padding: 8px 25px; border-radius: 50px; color: var(--watermark-idle); transition: all 0.4s ease;
        }
        .branding-link:hover { color: var(--watermark-hover); background: rgba(255,255,255,0.9); box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .branding-logo { width: 80px; filter: grayscale(100%); opacity: 0.5; transition: 0.4s; }
        .branding-link:hover .branding-logo { filter: grayscale(0%); opacity: 1; transform: scale(1.1); }
        .powered-by { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; font-weight: bold; }

        /* Hidden standard spinner since we use energy */
        .spinner { display: none; } 

        #custom-alert-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; justify-content: center; align-items: center; }
        .alert-box { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 350px; text-align: center; border: 2px solid var(--primary-color); }
        .alert-box button { padding: 8px 25px; background: var(--primary-color); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; }

        #gear-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.6); backdrop-filter: blur(8px); z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center; }
        .gears-container { position: relative; width: 150px; height: 150px; margin-bottom: 20px; }
        .gear { position: absolute; display: flex; justify-content: center; align-items: center; }
        .gear-1 { font-size: 80px; top: 0; left: 0; animation: rotate-cw 4s linear infinite; color: var(--primary-color); }
        .gear-2 { font-size: 55px; bottom: 10px; right: 15px; animation: rotate-ccw 4s linear infinite; color: black; opacity: 0.8; }
        .gear-3 { font-size: 35px; top: 10px; right: 10px; animation: rotate-cw 3s linear infinite; color: var(--primary-dark); }
        @keyframes rotate-cw { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes rotate-ccw { 0% { transform: rotate(0deg); } 100% { transform: rotate(-360deg); } }
        .loading-text { color: black; font-size: 16px; font-weight: 700; letter-spacing: 2px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="logo-container">
            <div class="logo"><img src="logo.png" alt="Logo" onerror="this.src='https://placehold.co/180x180?text=Logo'"></div>
        </div>
        <form class="login-form" onsubmit="event.preventDefault(); loginWithEmail();">
            <h2 style="margin-bottom: 20px;">WOF LOGIN</h2>
            <div class="input-group"><input type="email" id="email" placeholder="Email Address" required></div>
            <div class="input-group"><input type="password" id="password" placeholder="Password" required></div>
            <button type="submit" class="login-btn">Login</button>
        </form>
    </div>
    
    <div id="dashboard">
        <div class="header">
            <div></div>
            <h1 style="letter-spacing: 2px;">WORLD OUT FASHION</h1>
            <button onclick="logout()" style="padding: 10px 20px; border-radius: 50px; border: 1px solid #333; color: #333; background: white; cursor: pointer;">Logout</button>
        </div>
        <div class="dashboard-grid">
            <a href="dispatch.html" class="dashboard-item">
                <div class="icon"><i class="fas fa-truck"></i></div>
                <h2>Dispatch</h2>
                <p>Track product dispatches</p>
            </a>
            <a href="#" class="dashboard-item" data-status="coming-soon">
                <div class="icon"><i class="fas fa-undo"></i></div>
                <h2>Return</h2>
                <p>Process product returns</p>
            </a>
            <a href="stock.html" class="dashboard-item">
                <div class="icon"><i class="fas fa-boxes"></i></div>
                <h2>Stock</h2>
                <p>Manage inventory</p>
            </a>
            <a href="Report.html" class="dashboard-item">
                <div class="icon"><i class="fas fa-chart-bar"></i></div>
                <h2>Report</h2>
                <p>Analytics and reports</p>
            </a>
            <a href="Custoemersbill.html" class="dashboard-item">
                <div class="icon"><i class="fas fa-file-invoice-dollar"></i></div>
                <h2>Customer Bill</h2>
                <p>Generate bills</p>
            </a>
            <a href="lableprint.html" class="dashboard-item">
                <div class="icon"><i class="fas fa-tags"></i></div>
                <h2>Label Generate</h2>
                <p>Excel label printing</p>
            </a>
            <a href="payslip.html" class="dashboard-item">
                <div class="icon"><i class="fas fa-money-check"></i></div>
                <h2>PaySlip Generator</h2>
                <p>Generate employee payslips</p>
            </a>
        </div>
    </div>

    <!-- ENERGY OVERLAY (For Loading) -->
    <div id="energy-overlay">
        <div class="energy-core"></div>
        <!-- Particles added via JS -->
    </div>
    <div id="flash-overlay"></div>

    <!-- Branding -->
    <a href="https://www.facebook.com/share/17cb414CrE/?mibextid=wwXIfr" id="branding-link-trigger" class="branding-link">
        <span class="powered-by">Powered By</span>
        <img src="smartx.png" alt="DesignVerse" class="branding-logo" onerror="this.src='https://placehold.co/100x30?text=DesignVerse'">
    </a>

    <!-- Gear Overlay -->
    <div id="gear-overlay">
        <div class="gears-container">
            <div class="gear gear-1"><i class="fas fa-cog"></i></div>
            <div class="gear gear-3"><i class="fas fa-cog"></i></div>
            <div class="gear gear-2"><i class="fas fa-cog"></i></div>
        </div>
        <div class="loading-text">REDIRECTING...</div>
    </div>

    <div id="custom-alert-overlay">
        <div class="alert-box">
            <h3 id="alert-title"></h3>
            <p id="alert-message" style="margin: 15px 0; color: #666;"></p>
            <button onclick="closeAlert()">OK</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCtRXYy0TZvYdOKP-0dV4ntNjiA4Q1jQs8",
            authDomain: "logingdashbard.firebaseapp.com",
            projectId: "logingdashbard",
            storageBucket: "logingdashbard.appspot.com",
            messagingSenderId: "414837775498",
            appId: "1:414837775498:web:e861939b655f83d1d26173",
            measurementId: "G-SFXPE6FXRL"
        };
        firebase.initializeApp(firebaseConfig);

        // Branding
        document.getElementById('branding-link-trigger').addEventListener('click', function(e) {
            e.preventDefault(); 
            const targetUrl = this.getAttribute('href'); 
            const overlay = document.getElementById('gear-overlay');
            overlay.style.display = 'flex';
            setTimeout(() => { overlay.style.display = 'none'; window.open(targetUrl, '_blank'); }, 2000);
        });

        function showAlert(title, message) {
            document.getElementById('alert-title').innerText = title;
            document.getElementById('alert-message').innerText = message;
            document.getElementById('custom-alert-overlay').style.display = 'flex';
        }
        function closeAlert() { document.getElementById('custom-alert-overlay').style.display = 'none'; }

        document.querySelectorAll('.dashboard-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (this.dataset.status === 'coming-soon') {
                    e.preventDefault();
                    showAlert('Info', 'This feature is not yet available. Coming Soon!');
                }
            });
        });

        function createParticles() {
            const container = document.getElementById('energy-overlay');
            const existing = container.querySelectorAll('.particle');
            existing.forEach(p => p.remove());

            // Create energy lines that suck in
            for (let i = 0; i < 60; i++) {
                let p = document.createElement('div');
                p.className = 'particle';
                let angle = Math.random() * 360;
                p.style.setProperty('--angle', angle + 'deg');
                p.style.animation = `implode 0.8s ease-in infinite ${Math.random() * 0.5}s`; // Infinite loop during load
                container.appendChild(p);
            }
        }

        // Logic to assign random starting positions for the "Assemble" effect
        function prepareAssembleAnimation() {
            const items = document.querySelectorAll('.dashboard-item');
            items.forEach(item => {
                // Random positions (Scatter effect)
                const x = (Math.random() - 0.5) * 2000; 
                const y = (Math.random() - 0.5) * 2000; 
                const z = (Math.random() * 500) + 500; 
                
                item.style.setProperty('--startX', `${x}px`);
                item.style.setProperty('--startY', `${y}px`);
                item.style.setProperty('--startZ', `${z}px`);
                
                item.style.opacity = '0'; // Hide initially
                item.classList.remove('assemble-3d'); // Reset class
            });
        }

        function loginWithEmail() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // 1. Start Energy Animation IMMEDIATELY (Loading Phase)
            const energyOverlay = document.getElementById('energy-overlay');
            energyOverlay.style.display = 'flex';
            createParticles();

            // Prepare the icons in chaos positions (hidden)
            prepareAssembleAnimation();

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then(() => {
                    // Auth Success!
                    
                    // 2. Trigger Blast
                    const core = energyOverlay.querySelector('.energy-core');
                    const flash = document.getElementById('flash-overlay');
                    const loginScreen = document.getElementById('login-screen');
                    const dashboard = document.getElementById('dashboard');
                    const items = document.querySelectorAll('.dashboard-item');

                    // Stop infinite loop and run explode
                    core.style.animation = 'none';
                    core.offsetHeight; /* Trigger reflow */
                    core.style.animation = 'explodeCore 0.5s ease-out forwards';
                    
                    // White flash trigger
                    setTimeout(() => {
                        flash.style.opacity = '1';

                        // 3. Swap Screens under the flash
                        setTimeout(() => {
                            loginScreen.style.display = 'none';
                            energyOverlay.style.display = 'none';
                            dashboard.style.display = 'flex';

                            // 4. Trigger Assemble Animation (Scatter -> Assemble)
                            items.forEach((item, index) => {
                                // Add staggered delay for nice effect
                                setTimeout(() => {
                                    item.classList.add('assemble-3d');
                                }, index * 50); 
                            });

                            // Remove flash to reveal the assembling icons
                            flash.style.opacity = '0';
                        }, 400); // Wait for flash to max out

                        setTimeout(() => { flash.style.display = 'none'; }, 1500);

                    }, 400); // Time for core explosion to grow
                })
                .catch(() => { 
                    // Error: Stop animation
                    energyOverlay.style.display = 'none';
                    showAlert('Error', 'Invalid Login!'); 
                });
        }

        function logout() { firebase.auth().signOut().then(() => location.reload()); }
    </script>
</body>
</html>
