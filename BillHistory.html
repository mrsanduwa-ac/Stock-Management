<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill History - World Out Fashion</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* Header & Nav */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        h1 { margin: 0; color: #0288d1; }

        .btn-back {
            text-decoration: none;
            background: #0288d1;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
        }

        /* Stats Cards */
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            flex: 1;
            background: #e1f5fe;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .card h3 { margin: 0 0 10px 0; color: #555; font-size: 16px; }
        .card .value { font-size: 24px; font-weight: bold; color: #0288d1; }

        /* Search Bar */
        .search-box {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        /* Table */
        table { width: 100%; border-collapse: collapse; }
        th { background: #333; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        tr:hover { background-color: #f9f9f9; }

        .btn-edit {
            background: #4caf50; /* Green */
            color: white;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
            font-size: 14px;
        }
        .btn-edit:hover { opacity: 0.9; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Invoice History</h1>
        <!-- On clicking Create New, clear edit mode -->
        <a href="Custoemersbill.html" class="btn-back" onclick="localStorage.removeItem('editInvoiceId')">‚Üê Create New Invoice</a>
    </div>

    <!-- Summary Stats -->
    <div class="stats">
        <div class="card">
            <h3>Total Invoices</h3>
            <div class="value" id="totalCount">0</div>
        </div>
        <div class="card">
            <h3>Total Revenue</h3>
            <div class="value" id="totalRevenue">Rs. 0.00</div>
        </div>
    </div>

    <!-- Search -->
    <div class="search-box">
        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Search by Invoice Number or Customer Name...">
    </div>

    <!-- Data Table -->
    <table id="historyTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Invoice #</th>
                <th>Customer Name</th>
                <th style="text-align: right;">Amount (Rs)</th>
                <th style="text-align: center;">Action</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Rows will be loaded here -->
        </tbody>
    </table>
</div>

<script>
    // Load data on start
    loadHistory();

    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('worldOutFashionInvoices')) || [];
        const tableBody = document.getElementById('tableBody');
        let totalRev = 0;
        
        tableBody.innerHTML = ''; // Clear table

        // Sort by date (newest first)
        history.sort((a, b) => b.id - a.id);

        history.forEach((inv, index) => {
            totalRev += parseFloat(inv.total);
            
            const row = `<tr>
                <td>${inv.date}</td>
                <td><strong>${inv.invNo}</strong></td>
                <td>${inv.custName}</td>
                <td style="text-align: right;">${parseFloat(inv.total).toLocaleString('en-LK', {minimumFractionDigits: 2})}</td>
                <td style="text-align: center;">
                    <button class="btn-edit" onclick="editInvoice(${inv.id})">Edit / View</button>
                </td>
            </tr>`;
            tableBody.innerHTML += row;
        });

        // Update Stats
        document.getElementById('totalCount').innerText = history.length;
        document.getElementById('totalRevenue').innerText = 'Rs. ' + totalRev.toLocaleString('en-LK', {minimumFractionDigits: 2});
    }

    function editInvoice(id) {
        // Save the ID to edit in localStorage
        localStorage.setItem('editInvoiceId', id);
        // Redirect to main page to load data
        window.location.href = 'index.html';
    }

    function filterTable() {
        const input = document.getElementById('searchInput');
        const filter = input.value.toLowerCase();
        const table = document.getElementById('historyTable');
        const tr = table.getElementsByTagName('tr');

        for (let i = 0; i < tr.length; i++) {
            const tdInv = tr[i].getElementsByTagName('td')[1];
            const tdName = tr[i].getElementsByTagName('td')[2];
            
            if (tdInv || tdName) {
                const txtValueInv = tdInv.textContent || tdInv.innerText;
                const txtValueName = tdName.textContent || tdName.innerText;
                
                if (txtValueInv.toLowerCase().indexOf(filter) > -1 || txtValueName.toLowerCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
</script>

</body>
</html>